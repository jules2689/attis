{
  "builders": [
    {
      "type": "digitalocean",
      "region": "nyc3",
      "size": "1GB",
      "image": "ubuntu-14-04-x64"
    }
  ],
  "min_packer_version": "0.8.6",
  "provisioners": [
    {
      "destination": "/tmp",
      "source": "scripts/support/",
      "type": "file"
    },
    {
      "type": "shell",
      "script": "scripts/shared/create_deploy_user.sh"
    },
    {
      "execute_command": "chmod +x {{ .Path }}; sudo -S -u deploy -i /bin/bash -l -c '{{ .Vars }} {{ .Path }}'",
      "type": "shell",
      "scripts": [
        "scripts/shared/system_update.sh",
        "scripts/shared/ssh.sh",
        "scripts/caravel/dependencies.sh",
        "scripts/shared/postgres.sh",
        "scripts/shared/nginx.sh",
        "scripts/caravel/caravel.sh"
      ],
      "environment_vars": [
        "GITHUB_USER={{user `github_user`}}"
      ]
    },
    {
      "type": "shell",
      "script": "scripts/shared/cleanup.sh"
    }
  ],
  "variables": {
    "github_user": "{{env `GITHUB_USER`}}"
  }
}
